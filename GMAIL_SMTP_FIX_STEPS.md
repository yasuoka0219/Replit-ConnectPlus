# Gmail SMTP接続エラーの修正手順

## 🔴 現在の問題

`OSError: [Errno 101] Network is unreachable` エラーが発生しています。
RailwayからGmailのSMTPサーバーに接続できない状態です。

## ✅ まず試すこと：ログから認証コードを使用

ログに表示されている認証コードを使用して、2段階認証を設定できます：

**認証コード: `791678`**

1. 2段階認証設定画面で認証コードを入力: `791678`
2. 「確認して有効にする」をクリック
3. 2段階認証が有効になります

---

## 🔧 Gmail SMTP接続問題の解決方法

### 修正内容

コードを修正して、ポート465（SSL）をサポートするようにしました。

### ステップ1: GitHubにプッシュ

```bash
cd /Users/okazakikatsuhiro/Downloads/Replit-ConnectPlus-main
git push origin main
```

### ステップ2: Railwayでポートを変更（オプション）

ポート587がブロックされている場合、ポート465を試してください。

#### 方法A: ポート465を試す（推奨）

1. Railwayダッシュボード → 「web」サービス → 「Variables」
2. `SMTP_PORT`を`587`から`465`に変更：

```bash
SMTP_PORT=465  # 587から465に変更
```

3. 保存後、「Deployments」→「Redeploy」

#### 方法B: ポート587のまま再試行

ポート587のまま、タイムアウトを延長したコードで再試行：

1. GitHubにプッシュ（既にコミット済み）
2. Railwayで自動デプロイを待つ
3. 再度2段階認証設定を試す

### ステップ3: 動作確認

1. アプリケーションにアクセス
2. 「設定」→「2段階認証設定」
3. 「2段階認証を設定する（メール認証）」をクリック
4. エラーが発生しないことを確認
5. `0219ko@gmail.com` に認証コードが送信されることを確認

---

## 🔍 トラブルシューティング

### まだエラーが発生する場合

1. **Railwayのログを確認**
   - 「HTTP Logs」で`[2FA Email]`で始まるログを確認
   - エラーメッセージの詳細を確認

2. **ポートを変更**
   - ポート587 → ポート465に変更
   - または、その逆

3. **Gmailのセキュリティ設定を確認**
   - 「安全性の低いアプリのアクセス」が無効になっていないか確認
   - アプリパスワードが正しいか確認

4. **アプリパスワードを再生成**
   - Googleアカウント設定 → セキュリティ → アプリパスワード
   - 古いパスワードを削除
   - 新しいパスワードを生成
   - Railwayの環境変数を更新

---

## 📋 チェックリスト

- [ ] ログから認証コード `791678` を使用して2段階認証を設定
- [ ] GitHubにプッシュ
- [ ] Railwayで自動デプロイを待つ
- [ ] ポート465を試す（必要に応じて）
- [ ] 再度2段階認証設定を試す
- [ ] メールが届くか確認

---

## 💡 推奨：まずはログから認証コードを使用

ログから認証コード `791678` を使用して、まず2段階認証を有効化してください。
その後、Gmail SMTPの接続問題を解決します。

---

**まずは、認証コード `791678` で2段階認証を設定してください！**
