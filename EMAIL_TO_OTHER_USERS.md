# 他のユーザーへのメール送信機能について

CONNECT+ CRMで他のユーザー（顧客、取引先、連絡先）にメールを送信できるかについて説明します。

## 📋 現在の実装状況

### ✅ 実装済みのメール送信機能

現在、以下のメール送信機能が実装されています：

1. **システムユーザー（ログインユーザー）向け**
   - ✅ 2段階認証コード送信
   - ✅ パスワードリセットメール

### ❌ 未実装のメール送信機能

以下の機能は**現在実装されていません**：

1. **顧客・取引先・連絡先へのメール送信**
   - ❌ 連絡先（Contact）へのメール送信機能
   - ❌ 企業（Company）へのメール送信機能
   - ❌ 一斉メール送信機能
   - ❌ 見積書・請求書のメール送信機能

---

## 🔍 現在できること

### 1. 連絡先のメールアドレス表示

連絡先の詳細画面では、メールアドレスが表示され、`mailto:`リンクが設定されています：

- 連絡先詳細画面でメールアドレスをクリック
- ブラウザのメールクライアント（Gmail、Outlookなど）が開く
- 手動でメールを送信

**注意**: これはシステムから自動送信されるのではなく、ブラウザのメールクライアントを開くだけです。

---

## 💡 将来的な実装について

Gmail SMTPを設定すれば、将来的に以下の機能を追加することが可能です：

### 追加可能な機能

1. **連絡先へのメール送信**
   - 連絡先詳細画面から直接メール送信
   - メール本文のテンプレート機能

2. **見積書・請求書のメール送信**
   - PDFを添付してメール送信
   - 自動送信機能

3. **一斉メール送信**
   - 複数の連絡先に一斉送信
   - メールマーケティング機能

4. **通知メール**
   - 案件のステータス変更通知
   - タスクの期限通知
   - 活動履歴の通知

---

## 🚀 メール送信機能を追加する場合

### 必要なもの

1. **SMTP設定（既に説明済み）**
   - Gmail SMTP
   - または、SendGrid、Mailgun、Amazon SESなど

2. **追加実装**
   - メール送信機能の追加
   - UIの追加（メール送信ボタンなど）
   - メールテンプレート機能

### 実装の流れ

1. **メール送信ユーティリティの拡張**
   - `utils/email_2fa.py`を参考に、汎用的なメール送信機能を追加
   - または、新しい`utils/email_sender.py`を作成

2. **APIエンドポイントの追加**
   - `/api/contacts/<id>/send-email` など
   - メール送信リクエストを受け付ける

3. **UIの追加**
   - 連絡先詳細画面に「メール送信」ボタンを追加
   - メール送信フォーム（件名、本文など）

4. **メールテンプレート機能**
   - 見積書・請求書のメール送信
   - 自動送信機能

---

## 📊 現在の機能と将来の機能の比較

| 機能 | 現在 | 将来（実装後） |
|-----|------|--------------|
| **2段階認証メール** | ✅ 実装済み | ✅ 実装済み |
| **パスワードリセットメール** | ✅ 実装済み | ✅ 実装済み |
| **連絡先へのメール送信** | ❌ 未実装 | ✅ 追加可能 |
| **見積書・請求書のメール送信** | ❌ 未実装 | ✅ 追加可能 |
| **一斉メール送信** | ❌ 未実装 | ✅ 追加可能 |
| **通知メール** | ❌ 未実装 | ✅ 追加可能 |

---

## 🎯 まとめ

### 現在の状況

- ✅ **システムユーザー（ログインユーザー）へのメール送信**: 実装済み
- ❌ **顧客・取引先・連絡先へのメール送信**: 未実装

### 今できること

1. **Gmail SMTPを設定**
   - 2段階認証メール、パスワードリセットメールが使えるようになる

2. **連絡先のメールアドレスを表示**
   - 連絡先詳細画面でメールアドレスをクリック
   - ブラウザのメールクライアントが開く
   - 手動でメールを送信

### 将来的に追加可能

Gmail SMTPを設定すれば、将来的に以下の機能を追加できます：

- 連絡先へのメール送信
- 見積書・請求書のメール送信
- 一斉メール送信
- 通知メール

---

## 📚 参考資料

- [Gmail SMTP設定ガイド](./GMAIL_SMTP_SETUP.md)
- [本番環境メール機能実装手順](./PRODUCTION_EMAIL_SETUP.md)

---

**質問**: 他のユーザー（顧客、取引先、連絡先）へのメール送信機能を追加したい場合は、お知らせください。実装方法を提案します。
