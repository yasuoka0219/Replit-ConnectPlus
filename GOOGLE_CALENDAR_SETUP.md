# Googleカレンダー連携セットアップガイド

このガイドでは、CONNECT+とGoogleカレンダーの連携を設定する手順を説明します。

## 前提条件

- Googleアカウントを持っていること
- Google Cloud Consoleへのアクセス権限があること

## セットアップ手順

### 1. Google Cloud Consoleでプロジェクトを作成

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成（または既存のプロジェクトを選択）
3. プロジェクト名を入力して「作成」をクリック

### 2. Google Calendar APIを有効化

1. Google Cloud Consoleで「APIとサービス」→「ライブラリ」を選択
2. 「Google Calendar API」を検索
3. 「Google Calendar API」を選択して「有効にする」をクリック

### 3. OAuth 2.0認証情報を作成

1. 「APIとサービス」→「認証情報」を選択
2. 「認証情報を作成」→「OAuth クライアント ID」を選択
3. 同意画面を設定していない場合は、先に同意画面を設定します
   - 「OAuth同意画面」タブを選択
   - 「ユーザータイプ」を選択（通常は「外部」）
   - アプリ名、ユーザーサポートメール、開発者の連絡先情報を入力
   - 「保存して次へ」をクリック
   - スコープはそのままで「保存して次へ」
   - テストユーザーを追加（必要に応じて）
   - 「ダッシュボードに戻る」をクリック
4. 「OAuth クライアント ID」を作成
   - アプリケーションの種類: 「ウェブアプリケーション」
   - 名前: 「CONNECT+ Calendar Integration」など任意の名前
   - 承認済みのリダイレクト URI:
     - 開発環境: `http://localhost:5001/auth/google/callback`
     - 本番環境: `https://yourdomain.com/auth/google/callback`
   - 「作成」をクリック
5. **クライアント ID**と**クライアント シークレット**をコピーして保存

### 4. 環境変数を設定

`.env`ファイルに以下を追加：

```env
GOOGLE_CLIENT_ID=your_client_id_here
GOOGLE_CLIENT_SECRET=your_client_secret_here
GOOGLE_REDIRECT_URI=http://localhost:5001/auth/google/callback
```

**注意**: 本番環境の場合は、`GOOGLE_REDIRECT_URI`を本番環境のURLに変更してください。

### 5. データベースマイグレーションを実行

```bash
python3 migrate_google_calendar.py
```

### 6. アプリケーションを再起動

環境変数を変更した場合は、アプリケーションを再起動してください。

### 7. Googleカレンダーと連携

1. CONNECT+にログイン
2. 「設定」→「連携設定」→「Googleカレンダー連携」を選択
3. 「Googleカレンダーと連携する」ボタンをクリック
4. Googleアカウントでログインして権限を許可
5. 連携が完了すると、設定画面に「連携中」と表示されます

## 機能

### 自動同期

連携後、以下の操作でGoogleカレンダーに自動的に同期されます：

- **タスク作成**: 期限日があるタスクを作成すると、Googleカレンダーにイベントが追加されます
- **タスク更新**: タスクの期限日やタイトルを変更すると、カレンダーイベントも更新されます
- **タスク削除**: タスクを削除すると、カレンダーイベントも削除されます

### カレンダーイベントの詳細

- **タイトル**: タスクのタイトル
- **開始時刻**: 期限日の午前9時（デフォルト）
- **終了時刻**: 期限日の午前10時（デフォルト）
- **説明**: 関連する案件名（あれば）

## トラブルシューティング

### 連携できない

- Google Cloud Consoleで「OAuth同意画面」が正しく設定されているか確認
- リダイレクトURIが正しく設定されているか確認
- 環境変数が正しく設定されているか確認
- ブラウザのコンソールでエラーメッセージを確認

### カレンダーに同期されない

- 設定画面で「接続をテスト」ボタンをクリックして、接続を確認
- タスクに期限日が設定されているか確認
- サーバーのログでエラーメッセージを確認

### トークンの有効期限切れ

- 再度「Googleカレンダーと連携する」ボタンをクリックして認証を更新

## セキュリティに関する注意事項

- **クライアントシークレット**は絶対に公開しないでください
- 本番環境では、環境変数を安全に管理してください
- OAuthトークンは暗号化して保存することを推奨します（将来的な機能）

## サポート

問題が発生した場合は、サーバーのログを確認するか、管理者に問い合わせてください。



